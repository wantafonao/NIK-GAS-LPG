<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NIK GAS LPG</title>

<style>
:root {
  --primary: #2563eb;
  --success: #16a34a;
  --warning: #f59e0b;
  --danger: #dc2626;
  --bg: #f8fafc;
  --card: #ffffff;
  --border: #e5e7eb;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: #111827;
  line-height: 1.5;
  padding: 15px;
  min-height: 100vh;
}

/* Header */
.header {
  background: linear-gradient(135deg, #2563eb, #1e40af);
  color: white;
  padding: 20px 15px;
  border-radius: 16px;
  margin-bottom: 20px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
}

.header h1 {
  font-size: 22px;
  margin-bottom: 15px;
}

.mode-switch {
  display: flex;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 12px;
  padding: 4px;
  max-width: 280px;
  margin: 0 auto;
}

.mode-btn {
  flex: 1;
  padding: 10px;
  border: none;
  background: transparent;
  color: white;
  font-size: 14px;
  font-weight: 500;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
}

.mode-btn.active {
  background: white;
  color: #2563eb;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Section Styles */
.section {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.section-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 18px;
  color: #111827;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--border);
}

/* Sales Section */
.sales-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 10px;
}

.sales-table th {
  background: #f8fafc;
  padding: 12px 8px;
  font-size: 14px;
  font-weight: 600;
  color: #4b5563;
  border-bottom: 2px solid var(--border);
  text-align: center;
}

.sales-table td {
  padding: 8px;
  border-bottom: 1px solid var(--border);
  text-align: center;
}

.sales-input {
  width: 100%;
  padding: 10px 8px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-family: monospace;
  font-size: 14px;
  text-align: center;
  background: white;
}

.sales-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.sales-actions {
  display: flex;
  gap: 6px;
  justify-content: center;
}

.btn-small {
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-save {
  background: var(--primary);
  color: white;
}

.btn-delete {
  background: var(--danger);
  color: white;
}

.date-cell {
  font-size: 12px;
  color: #6b7280;
  font-family: monospace;
}

/* Controls */
.controls {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-warning {
  background: var(--warning);
  color: white;
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn:hover {
  opacity: 0.9;
  transform: translateY(-1px);
}

/* Search Box */
.search-box {
  margin: 20px 0;
}

.search-input {
  width: 100%;
  padding: 14px 20px;
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 16px;
  background: white;
}

.search-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin: 20px 0;
}

.stat {
  background: white;
  border-radius: 12px;
  padding: 15px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.stat-label {
  display: block;
  font-size: 12px;
  color: #6b7280;
  margin-bottom: 5px;
}

.stat-value {
  display: block;
  font-size: 20px;
  font-weight: 700;
  color: #111827;
}

/* NIK Table */
.nik-table-container {
  overflow-x: auto;
  border-radius: 12px;
  border: 1px solid var(--border);
  margin-bottom: 15px;
}

.nik-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 300px;
}

.nik-table th {
  background: #f8fafc;
  padding: 15px 10px;
  font-size: 14px;
  font-weight: 600;
  color: #4b5563;
  border-bottom: 2px solid var(--border);
  position: sticky;
  top: 0;
}

.nik-table td {
  padding: 12px 10px;
  border-bottom: 1px solid var(--border);
  text-align: center;
}

.nik-cell {
  font-family: monospace;
  font-size: 15px;
  letter-spacing: 0.5px;
  word-break: break-all;
}

/* Action Buttons */
.action-buttons {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.btn-action {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.btn-action:hover {
  transform: scale(1.1);
}

.btn-copy {
  background: var(--primary);
  color: white;
}

.btn-edit {
  background: var(--warning);
  color: white;
}

.btn-remove {
  background: var(--danger);
  color: white;
}

/* Edit Input */
.edit-input {
  width: 100%;
  padding: 10px;
  border: 2px solid var(--primary);
  border-radius: 8px;
  font-family: monospace;
  font-size: 14px;
  text-align: center;
  background: #f8fafc;
}

/* Add Button */
.add-button-container {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px solid var(--border);
  text-align: center;
}

.btn-add {
  background: var(--success);
  color: white;
  border: none;
  border-radius: 12px;
  padding: 14px 30px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
}

.btn-add:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}

/* Notification System - MAX 2 NOTIFIKASI */
.notification-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  max-width: 300px;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.notification {
  background: white;
  border-radius: 10px;
  padding: 12px 16px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  border-left: 4px solid var(--primary);
  animation: slideInRight 0.3s ease-out;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  position: relative;
  overflow: hidden;
}

.notification.success {
  border-left-color: var(--success);
}

.notification.warning {
  border-left-color: var(--warning);
}

.notification.danger {
  border-left-color: var(--danger);
}

.notification-icon {
  font-size: 16px;
  flex-shrink: 0;
  margin-top: 2px;
}

.notification-content {
  flex: 1;
  min-width: 0;
}

.notification-content h4 {
  font-size: 14px;
  margin-bottom: 3px;
  color: #111827;
  line-height: 1.3;
}

.notification-content p {
  font-size: 12px;
  color: #6b7280;
  margin: 0;
  line-height: 1.3;
}

.notification-close {
  background: none;
  border: none;
  font-size: 18px;
  color: #9ca3af;
  cursor: pointer;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.notification-close:hover {
  color: #111827;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOutRight {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}

/* Confirm Dialog */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadeIn 0.3s;
}

.dialog {
  background: white;
  border-radius: 16px;
  padding: 24px;
  width: 100%;
  max-width: 350px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  animation: slideUp 0.3s;
}

.dialog h3 {
  font-size: 18px;
  margin-bottom: 10px;
  color: #111827;
}

.dialog p {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 20px;
  line-height: 1.5;
}

.dialog-buttons {
  display: flex;
  gap: 12px;
}

.dialog-buttons .btn {
  flex: 1;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Responsive */
@media (max-width: 480px) {
  body {
    padding: 10px;
  }
  
  .header {
    padding: 15px;
  }
  
  .header h1 {
    font-size: 20px;
  }
  
  .section {
    padding: 15px;
  }
  
  .section-title {
    font-size: 16px;
  }
  
  .sales-table th,
  .sales-table td {
    padding: 6px 4px;
    font-size: 13px;
  }
  
  .sales-input {
    padding: 8px 4px;
    font-size: 13px;
  }
  
  .btn-small {
    padding: 6px 10px;
    font-size: 12px;
  }
  
  .nik-table th,
  .nik-table td {
    padding: 10px 8px;
    font-size: 14px;
  }
  
  .nik-cell {
    font-size: 13px;
  }
  
  .btn-action {
    width: 36px;
    height: 36px;
    font-size: 14px;
  }
  
  .stats {
    grid-template-columns: 1fr;
    gap: 8px;
  }
  
  .stat {
    padding: 12px;
  }
  
  .notification-container {
    max-width: calc(100% - 20px);
    right: 10px;
    top: 10px;
  }
  
  .notification {
    padding: 10px 14px;
  }
  
  .notification-content h4 {
    font-size: 13px;
  }
  
  .notification-content p {
    font-size: 11px;
  }
}
</style>
</head>

<body>
<!-- Header dengan Mode Switch -->
<div class="header">
  <h1>NIK GAS LPG</h1>
  <div class="mode-switch">
    <button class="mode-btn active" onclick="setMode('copy')">SALIN NIK</button>
    <button class="mode-btn" onclick="setMode('edit')">EDIT NIK</button>
  </div>
</div>

<!-- Catatan Penjualan -->
<div class="section">
  <div class="section-title">üìù CATATAN PENJUALAN</div>
  
  <div class="nik-table-container">
    <table class="sales-table">
      <thead>
        <tr>
          <th width="60">NO</th>
          <th>AWAL</th>
          <th>AKHIR</th>
          <th width="120">AKSI</th>
          <th width="100">TANGGAL</th>
        </tr>
      </thead>
      <tbody id="salesBody">
        <!-- Data akan diisi oleh JavaScript -->
      </tbody>
    </table>
  </div>
  
  <div class="controls">
    <button class="btn btn-warning" onclick="resetSales()">RESET</button>
  </div>
</div>

<!-- Pencarian dan Statistik -->
<div class="section">
  <div class="search-box">
    <input type="text" class="search-input" id="searchInput" placeholder="Cari NIK atau nomor..." oninput="searchNIK()">
  </div>
  
  <div class="stats">
    <div class="stat">
      <span class="stat-label">TOTAL</span>
      <span class="stat-value" id="totalCount">0</span>
    </div>
    <div class="stat">
      <span class="stat-label">TERSALIN</span>
      <span class="stat-value" id="copiedCount">0</span>
    </div>
    <div class="stat">
      <span class="stat-label">BELUM</span>
      <span class="stat-value" id="remainingCount">0</span>
    </div>
  </div>
</div>

<!-- Daftar NIK -->
<div class="section">
  <div class="section-title" id="nikTitle">üìã DAFTAR NIK</div>
  
  <div class="nik-table-container">
    <table class="nik-table" id="nikTable">
      <thead>
        <tr>
          <th width="60">NO</th>
          <th>NIK</th>
          <th width="100">AKSI</th>
        </tr>
      </thead>
      <tbody id="nikBody">
        <!-- Data akan diisi oleh JavaScript -->
      </tbody>
    </table>
  </div>
  
  <!-- Tombol Tambah NIK -->
  <div class="add-button-container" id="addButtonContainer" style="display: none;">
    <button class="btn-add" onclick="addNewNIK()">
      <span style="font-size: 18px;">+</span> TAMBAH NIK BARU
    </button>
  </div>
</div>

<!-- Notification Container (MAKSIMAL 2) -->
<div class="notification-container" id="notificationContainer"></div>

<!-- Confirm Dialog -->
<div class="dialog-overlay" id="confirmDialog" style="display: none;">
  <div class="dialog">
    <h3 id="dialogTitle">Konfirmasi</h3>
    <p id="dialogMessage">Apakah Anda yakin?</p>
    <div class="dialog-buttons">
      <button class="btn" onclick="hideDialog()">BATAL</button>
      <button class="btn btn-danger" id="dialogConfirmBtn">YA</button>
    </div>
  </div>
</div>

<script>
// ==================== SOLUSI SEDERHANA YANG 100% BERFUNGSI ====================

// VARIABEL GLOBAL
let currentMode = 'copy';
let nikData = [];
let salesData = [];
let salesBackup = null;
let salesActionInfo = null;
let nikBackup = null;
let nikActionInfo = null;

// SET SESSION UNTUK NIK YANG SUDAH DISALIN (HANYA UNTUK SESI INI)
let sessionCopiedNIKs = new Set();

// Data NIK awal - 517 NIK PERSIS SEPERTI DAFTAR ANDA
const initialNIKList = [
  "1214021203620002","1214026508690001","1214020607000012","1214021710660001",
  "1214021001890011","1214026809870002","1278011406760002","1278014804800001",
  "1278015009000001","1214020504920004","1214020704650004","1214024706750015",
  "1214024105990010","1214021610010007","1214020704790004","1214027003850003",
  "1214022109710002","1214021205010001","1214023110030004","1214026512040001",
  "1214020804640004","1214025003700006","1214020704960010","1214021602020007",
  "1214026306050007","1214021209730001","1214027107000001","1214026602050001",
  "1214021706070001","1214021011030004","1214025201070004","1214025502080001",
  "1271070610940002","1214021110950011","1214020505000009","1214020403020007",
  "1214021003040003","1214025409920003","1214024110030002","1214020606050003",
  "1214025203800008","1214020408720003","1214025703790002","1214021909990010",
  "1214022806050001","1214020112740003","1214025008800005","1214021011800009",
  "1214024512790005","1214026804930001","1214020912980004","1214024703030008",
  "1214251208000001","1214025203700005","1214024307970004","1214020505070008",
  "1214021709960009","1214021005760010","1214026606860001","1214030908780004",
  "1214036103750001","1204015402890009","1214025911720001","1214022204070003",
  "1214171212900004","1214031709960002","1214023103880001","1214026104930001",
  "1214025607930005","1214025107950009","1214023007980003","1214024404020015",
  "1214020607820009","1214025808080002","1214022801790001","1214021912000001",
  "1214020202030001","1214026108950005","1214027003490001","1214026402830001",
  "1503082512740003","1503085708740002","1503084811000002","1503082102040001",
  "1503085811070001","1214020405790004","1214024609800009","1214024811000007",
  "1214024908030001","1214021611060001","1214021305590003","1214025207670001",
  "1214024810980005","1214025210030003","1214025502050001","1204235406880001",
  "1214021509020007","1214020305930011","1214025204980003","1214020406580002",
  "1214024803580003","1214026705940004","1214021004940016","1214024210980001",
  "1214021703830003","1214020404600004","1214020305900004","1214020607060009",
  "1214022211870002","1214020612840002","1214026302890002","1214020801300002",
  "1214025502350002","1214025502030005","1214024812070002","1214026509780001",
  "1214024512040001","1214020501080001","1214025007620003","1214021203930005",
  "1214025304980005","1214021202040004","1214024107550005","1214022106970003",
  "1214020908040002","1214021208060004","1214032309920001","1214032006010001",
  "1214021009860006","1214064802870003","1214032411930004","1204264111940001",
  "1214030204680001","1214036308710001","1214036604980004","1214031702070002",
  "1214020309880008","1214024506880010","1214022705080002","1214021703870006",
  "1214026510880002","1214024412080002","1214023011830001","1214024508920003",
  "1214020803000009","1214024206060005","1214250209920001","1214175109960002",
  "1214024302900008","1214020506900014","1214022406760002","1214026406770001",
  "1214025603040003","1214022510870003","1214174910900003","1214021305880003",
  "1214026805910001","1214020105820003","1214024202910001","1214020601900009",
  "1214024505930006","1214020503970011","1214025705990009","1214020704040001",
  "1214023112060001","1214025002600005","1214020411840005","1214022910870001",
  "1214021807980010","1214024207990011","1214021907010003","1214020208030005",
  "1214024109060005","1214345604920001","1214021005730004","1214025106750005",
  "1214021506790003","1214024709800008","1214020907000008","1214024204030006",
  "1214020608060004","1214021402080002","1214026906940001","1214020601910004",
  "1214025505910004","1214025512080001","1214021408910002","1214176912920001",
  "1214350804990001","1214020507870004","1214064909910004","1204051708890003",
  "1214024606950007","1214021206900010","1214024405940006","1214020307920011",
  "1214026205950005","1801041008870019","1214354701950001","1214021212900001",
  "1214025804940004","1214021701940002","1214020408880008","1214025204900003",
  "1214022512910007","1214021608910004","1214036808920003","1214021808890005",
  "1214025501970009","1214090203870001","1214024406930006","1214021206810004",
  "1214021904790003","1214276903860001","1214022307970001","1214270911980001",
  "1214022109650001","1214025011660003","1214022306990005","1214024903030013",
  "1214021102060003","1214021201780006","1214027004010005","1214024402020007",
  "1214020607040009","1214024409060004","1214024502990008","1214270512980001",
  "1214024712020004","1214020108920002","1214275112910001","1214034905880004",
  "1214022404940003","1214025102000009","1214022101890004","1214027005940002",
  "1214020510670008","1214024608770001","1214022406820001","1214025507850006",
  "1214020604630002","1214022510950004","1214024903710001","1214020501960009",
  "1214066007990009","1214026509030001","1214020804840005","1214025911810001",
  "1214024005030005","1214022105050008","1214024909060001","1214020103050001",
  "1214025404820008","1214022111010007","1214025108080004","1214020811800005",
  "1214026003810004","1214021411050001","1214022100710001","1214025201700005",
  "1214026611900003","1214021901930001","1214021002990008","1214036708020004",
  "1214026104700004","1214022409030002","1214021708770006","1214025406820001",
  "1214022409980005","1214026702020007","1214021204040004","1214350107880001",
  "1214026206680001","1214352101950001","1214356710970001","1214026911810001",
  "1214024806030005","1214022105050005","1214024909060001","1214020103080001",
  "1214021010800009","1214026412840003","1214022404020007","1214025207050003",
  "1214024108080005","1214020102840006","1214024902660003","1214020810080001",
  "1214022007930002","1214025002940007","1214022404230002","1214024507780009",
  "1214022102080003","1214171211830003","1214174311910001","1214170708760002",
  "1214175509760001","1214170410970001","1214176805000001","1214172207030001",
  "1214171510060001","1214172607770001","1214174704910002","1214174304980001",
  "1214172612000001","1214170108650001","1214174305750001","1214174510010001",
  "1214170709040001","1214020103830001","1214024401850004","1214176012000002",
  "1214171602840001","1214174910850005","1214182406850001","1214184508920001",
  "1214184107020001","1214020509740003","1214176009960001","1214025110060004",
  "1214025211070004","1214020603820005","1214026001830004","1214026010040002",
  "1214022511060001","1214170612790001","1214176711850001","1214171710030001",
  "1214174106050001","1214174110080001","1214021404820004","1214024606790006",
  "1214025303990002","1214022802760001","1214025504760005","1214174101040003",
  "1214171505060001","1214174304080002","1214021212720002","1214175311750002",
  "1214026304960005","1214024111980005","1214026002020011","1214026203050003",
  "1214170510080002","1214170404860001","1214174712880001","1214176607080001",
  "1214172711880001","1214174611890001","1214170105880001","1214176003880002",
  "1214176911090001","1214171803620001","1214174411630001","1214175512970001",
  "1214175110980001","1214175101030001","1214020605680005","1214020705820004",
  "1214024604920012","1214021001800009","1214171104740001","1214175206820001",
  "1214176102990002","1214172312010001","1214170105030002","1214174210060001",
  "1214171008760001","1214175703780001","1214172810010001","1214170811030001",
  "1214174709080001","1214020112830001","1214025110850002","1214174607020004",
  "1214172304070001","1214171005850003","1214175505910001","1214173004080001",
  "1214170810730001","1214175206740001","1214170102940001","1214176509980001",
  "1214170312000001","1214175010070001","1214171112890002","1214175010950003",
  "1406161202810001","1406165304820001","1406163008030001","1406166110050001",
  "1406166505080001","1214171705870002","1214177007910001","1214021012690005",
  "1214175204900004","1214171405930001","1214021507900006","1214024909910002",
  "1214270502930001","1214275104940002","1214022705820001","1214026102860001",
  "1214026011060004","1214021605640005","1214024402650002","1214025710980004",
  "1214025410010007","1214021506740004","1214025111910004","1214027008040005",
  "1214021704820006","1214024801890004","1214021804900005","1214275210890001",
  "1214022301870003","1214274506970001","1214022706800006","1214024808810005",
  "1214024708030006","1214024412040003","1214025408060002","1214024709070004",
  "1214020107790010","1214024103810005","1214022906060002","1214270709080001",
  "1214020305900006","1214174310860002","1214020210670002","1214025502730004",
  "1214025008950009","1214271305970001","1214277012000001","1214027012000006",
  "1214021503730006","1214025408890001","1214026003950012","1214023108000002",
  "1214026302020001","1214020311050002","1214020803880007","1214025405750006",
  "1214026905050004","1214025002070005","1214022909080002","1214026003730004",
  "1214025806930007","1214020704970001","1214025503990008","1214020604020021",
  "1214022411030002","1214021505050007","1214022111070004","1214021212620002",
  "1214025204700005","1214271502990001","1214024106020006","1214026301030005",
  "1214023108050002","1214020208060004","1214020601740001","1214025608760001",
  "1214021309030005","1214020403070003","1214021008650003","1214024209770001",
  "1214024305980010","1214020406000017","1214026304030001","1214025807020007",
  "1214026607060001","1214021704620004","1214026405640001","1214027101820002",
  "1214024504920005","1214271612950001","1214271303990001","1214025210010005",
  "1214021411030003","1214022510740003","1278026704740001","1214020811040005",
  "1214024405830011","1214020612060005","1214027010080001","1214022003850003",
  "1214026006910006","1214022509780005","1214024308850001","1214024811080001",
  "1214021701900005","1214025008950010","1214014109890004","1214020209850007",
  "1214024503900007","1214020706850006","1214024110850003","1214022810070003",
  "1214022510850001","1214024102900012","1214021503480005","1214023105090002",
  "1214022109880001","1214025003860005","1214020607740006","1214025507840007",
  "1214021803030005","1214022803060004","1214021110780001","1214024602800009",
  "1214276502050001","1214276507070001","1214022509850003","1214024302860006",
  "1214024406050008"
];

// ==================== FUNGSI UTAMA ====================
function setMode(mode) {
  currentMode = mode;
  
  // Update tombol mode
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  document.querySelector(`.mode-btn[onclick="setMode('${mode}')"]`).classList.add('active');
  
  // Update tampilan
  const addButtonContainer = document.getElementById('addButtonContainer');
  const nikTitle = document.getElementById('nikTitle');
  
  if (mode === 'edit') {
    addButtonContainer.style.display = 'block';
    nikTitle.innerHTML = '‚úèÔ∏è EDIT DAFTAR NIK';
    showNotification('Mode Edit', 'Sekarang Anda bisa edit dan hapus NIK', 'warning');
  } else {
    addButtonContainer.style.display = 'none';
    nikTitle.innerHTML = 'üìã DAFTAR NIK';
    showNotification('Mode Salin', 'Kembali ke mode salin NIK', 'info');
  }
  
  renderNIKTable();
}

// ==================== SISTEM NOTIFIKASI ====================
function showNotification(title, message, type = 'info') {
  const container = document.getElementById('notificationContainer');
  
  // Batasi maksimal 2 notifikasi
  const notifications = container.querySelectorAll('.notification');
  if (notifications.length >= 2) {
    notifications[0].remove();
  }
  
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  
  let icon = '‚ÑπÔ∏è';
  if (type === 'success') icon = '‚úÖ';
  if (type === 'warning') icon = '‚ö†Ô∏è';
  if (type === 'danger') icon = '‚ùå';
  
  notification.innerHTML = `
    <div class="notification-icon">${icon}</div>
    <div class="notification-content">
      <h4>${title}</h4>
      <p>${message}</p>
    </div>
    <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
  `;
  
  container.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentElement) {
      notification.remove();
    }
  }, 4000);
}

// ==================== FUNGSI DIALOG ====================
let dialogCallback = null;

function showDialog(title, message, confirmCallback) {
  document.getElementById('dialogTitle').textContent = title;
  document.getElementById('dialogMessage').textContent = message;
  dialogCallback = confirmCallback;
  document.getElementById('confirmDialog').style.display = 'flex';
}

function hideDialog() {
  document.getElementById('confirmDialog').style.display = 'none';
  dialogCallback = null;
}

document.getElementById('dialogConfirmBtn').onclick = function() {
  if (dialogCallback) {
    dialogCallback();
  }
  hideDialog();
};

// ==================== SISTEM NIK DATA YANG SIMPLE DAN BERFUNGSI ====================

// INISIALISASI DATA NIK (TIDAK SIMPAN STATUS SALIN DI LOCALSTORAGE)
function loadNIKData() {
  // Cek apakah ada data NIK di localStorage
  const savedNIKData = localStorage.getItem('nikData');
  
  if (savedNIKData) {
    try {
      nikData = JSON.parse(savedNIKData);
    } catch (e) {
      initDefaultNIKData();
    }
  } else {
    initDefaultNIKData();
  }
  
  // RESET sessionCopiedNIKs setiap kali halaman dimuat
  sessionCopiedNIKs.clear();
  
  updateStats();
  renderNIKTable();
}

function initDefaultNIKData() {
  nikData = initialNIKList.map((nik, index) => ({
    id: index + 1,
    nik: nik
  }));
  saveNIKData();
}

function saveNIKData() {
  try {
    localStorage.setItem('nikData', JSON.stringify(nikData));
  } catch (e) {
    console.error('Error saving nikData:', e);
  }
}

// RENDER TABEL NIK
function renderNIKTable() {
  const tbody = document.getElementById('nikBody');
  tbody.innerHTML = '';
  
  nikData.forEach((item, index) => {
    const tr = document.createElement('tr');
    const isCopied = sessionCopiedNIKs.has(item.nik);
    
    if (currentMode === 'edit') {
      // Mode Edit
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>
          <input type="text" 
                 class="edit-input" 
                 value="${item.nik}" 
                 maxlength="16"
                 oninput="updateNIK(${item.id}, this.value)"
                 placeholder="16 digit NIK">
        </td>
        <td>
          <div class="action-buttons">
            <button class="btn-action btn-remove" onclick="deleteNIK(${item.id})" title="Hapus">
              ‚úï
            </button>
          </div>
        </td>
      `;
    } else {
      // Mode Salin
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td class="nik-cell">${item.nik}</td>
        <td>
          <div class="action-buttons">
            <button class="btn-action btn-copy" 
                    onclick="copyNIK('${item.nik}', this)" 
                    ${isCopied ? 'disabled style="opacity:0.5"' : ''}
                    title="${isCopied ? 'Sudah disalin (sementara)' : 'Salin NIK'}">
              ${isCopied ? '‚úì' : '‚éò'}
            </button>
          </div>
        </td>
      `;
    }
    
    tbody.appendChild(tr);
  });
}

// UPDATE NIK
function updateNIK(id, newValue) {
  newValue = newValue.replace(/\D/g, '');
  if (newValue.length > 16) newValue = newValue.substring(0, 16);
  
  const index = nikData.findIndex(item => item.id === id);
  if (index !== -1) {
    const oldNik = nikData[index].nik;
    nikData[index].nik = newValue;
    
    // Jika NIK diubah, hapus dari sessionCopiedNIKs
    if (sessionCopiedNIKs.has(oldNik)) {
      sessionCopiedNIKs.delete(oldNik);
    }
    
    saveNIKData();
    renderNIKTable();
    updateStats();
  }
}

// SALIN NIK - VERSI YANG 100% BERFUNGSI
function copyNIK(nik, buttonElement) {
  if (!nik || nik.length !== 16) {
    showNotification('Error', 'NIK harus 16 digit angka', 'danger');
    return;
  }
  
  // Coba Clipboard API modern
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(nik)
      .then(() => {
        handleCopySuccess(nik, buttonElement);
      })
      .catch(err => {
        // Fallback ke metode lama
        useFallbackCopy(nik, buttonElement);
      });
  } else {
    // Gunakan fallback
    useFallbackCopy(nik, buttonElement);
  }
}

function useFallbackCopy(nik, buttonElement) {
  const textArea = document.createElement('textarea');
  textArea.value = nik;
  textArea.style.position = 'fixed';
  textArea.style.top = '0';
  textArea.style.left = '0';
  textArea.style.width = '2em';
  textArea.style.height = '2em';
  textArea.style.padding = '0';
  textArea.style.border = 'none';
  textArea.style.outline = 'none';
  textArea.style.boxShadow = 'none';
  textArea.style.background = 'transparent';
  
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    const successful = document.execCommand('copy');
    if (successful) {
      handleCopySuccess(nik, buttonElement);
    } else {
      showNotification('Gagal', 'Gagal menyalin NIK', 'danger');
    }
  } catch (err) {
    showNotification('Gagal', 'Gagal menyalin NIK', 'danger');
  }
  
  document.body.removeChild(textArea);
}

function handleCopySuccess(nik, buttonElement) {
  // Tambahkan ke Set session (hanya untuk sesi ini)
  sessionCopiedNIKs.add(nik);
  
  // Update tombol
  if (buttonElement) {
    buttonElement.textContent = '‚úì';
    buttonElement.disabled = true;
    buttonElement.style.opacity = '0.5';
    buttonElement.title = 'Sudah disalin (sementara)';
  }
  
  // Update statistik
  updateStats();
  
  // Tampilkan notifikasi
  showNotification('Berhasil!', `NIK ${nik} telah disalin`, 'success');
}

// FUNGSI LAIN UNTUK NIK
function deleteNIK(id) {
  const index = nikData.findIndex(item => item.id === id);
  if (index === -1) return;
  
  // Backup untuk undo
  nikBackup = JSON.parse(JSON.stringify(nikData));
  nikActionInfo = {
    type: 'delete',
    id: id,
    nik: nikData[index].nik,
    index: index
  };
  
  showDialog('Hapus NIK', `Hapus NIK ${nikData[index].nik}?`, () => {
    // Hapus dari sessionCopiedNIKs jika ada
    if (sessionCopiedNIKs.has(nikData[index].nik)) {
      sessionCopiedNIKs.delete(nikData[index].nik);
    }
    
    nikData.splice(index, 1);
    // Update ID
    nikData.forEach((item, idx) => {
      item.id = idx + 1;
    });
    
    saveNIKData();
    renderNIKTable();
    updateStats();
    
    showNotificationWithUndo(
      `NIK berhasil dihapus`,
      'success',
      `‚Ü∂ Batalkan`,
      undoNIKAction
    );
  });
}

function undoNIKAction() {
  if (!nikBackup || !nikActionInfo) return;
  
  nikData = JSON.parse(JSON.stringify(nikBackup));
  saveNIKData();
  renderNIKTable();
  updateStats();
  
  showNotification('Dibatalkan', 'Aksi hapus NIK dibatalkan', 'info');
  
  nikBackup = null;
  nikActionInfo = null;
}

function addNewNIK() {
  const newId = nikData.length > 0 ? Math.max(...nikData.map(n => n.id)) + 1 : 1;
  nikData.push({
    id: newId,
    nik: ''
  });
  
  saveNIKData();
  renderNIKTable();
  
  const addButton = document.querySelector('.add-button-container');
  addButton.scrollIntoView({ behavior: 'smooth', block: 'end' });
  
  showNotification('Info', 'Baris NIK baru ditambahkan', 'info');
}

function searchNIK() {
  const keyword = document.getElementById('searchInput').value.toLowerCase();
  const rows = document.querySelectorAll('#nikBody tr');
  
  rows.forEach((row, index) => {
    const nik = row.querySelector('.nik-cell')?.textContent || 
                row.querySelector('.edit-input')?.value || '';
    const no = index + 1;
    
    if (nik.toLowerCase().includes(keyword) || no.toString().includes(keyword)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}

function updateStats() {
  const total = nikData.length;
  const copiedCount = sessionCopiedNIKs.size;
  const remaining = total - copiedCount;
  
  document.getElementById('totalCount').textContent = total;
  document.getElementById('copiedCount').textContent = copiedCount;
  document.getElementById('remainingCount').textContent = remaining;
}

// ==================== CATATAN PENJUALAN ====================
function loadSalesData() {
  const saved = localStorage.getItem('salesData');
  if (saved) {
    try {
      return JSON.parse(saved);
    } catch (e) {
      return getDefaultSalesData();
    }
  }
  return getDefaultSalesData();
}

function getDefaultSalesData() {
  return [
    { id: 1, start: '', end: '', date: '' },
    { id: 2, start: '', end: '', date: '' },
    { id: 3, start: '', end: '', date: '' },
    { id: 4, start: '', end: '', date: '' }
  ];
}

function saveSalesData(data) {
  try {
    localStorage.setItem('salesData', JSON.stringify(data));
  } catch (e) {
    console.error('Error saving salesData:', e);
  }
}

function renderSalesTable() {
  salesData = loadSalesData();
  const tbody = document.getElementById('salesBody');
  
  tbody.innerHTML = salesData.map(item => `
    <tr>
      <td style="font-weight:bold;">${item.id}</td>
      <td>
        <input type="text" class="sales-input" id="start${item.id}" 
               value="${item.start}" placeholder="Awal" maxlength="20">
      </td>
      <td>
        <input type="text" class="sales-input" id="end${item.id}" 
               value="${item.end}" placeholder="Akhir" maxlength="20">
      </td>
      <td>
        <div class="sales-actions">
          <button class="btn-small btn-save" onclick="saveSalesRow(${item.id})">‚úì SIMPAN</button>
          <button class="btn-small btn-delete" onclick="deleteSalesRow(${item.id})">‚úï HAPUS</button>
        </div>
      </td>
      <td class="date-cell">${item.date || ''}</td>
    </tr>
  `).join('');
}

function saveSalesRow(id) {
  const startInput = document.getElementById(`start${id}`);
  const endInput = document.getElementById(`end${id}`);
  const start = startInput.value.trim();
  const end = endInput.value.trim();
  
  if (!start && !end) {
    showNotification('Peringatan', 'Tidak ada data untuk disimpan', 'warning');
    return;
  }
  
  salesBackup = JSON.parse(JSON.stringify(salesData));
  salesActionInfo = { type: 'save', id: id };
  
  const index = salesData.findIndex(item => item.id === id);
  if (index !== -1) {
    salesData[index].start = start;
    salesData[index].end = end;
    salesData[index].date = new Date().toLocaleDateString('id-ID');
    
    saveSalesData(salesData);
    renderSalesTable();
    
    showNotificationWithUndo(
      `Data penjualan #${id} disimpan`,
      'success',
      `‚Ü∂ Batalkan`,
      undoSalesAction
    );
  }
}

function deleteSalesRow(id) {
  salesBackup = JSON.parse(JSON.stringify(salesData));
  salesActionInfo = { type: 'delete', id: id };
  
  showDialog('Hapus Data', `Hapus data penjualan #${id}?`, () => {
    const index = salesData.findIndex(item => item.id === id);
    if (index !== -1) {
      salesData[index].start = '';
      salesData[index].end = '';
      salesData[index].date = '';
      
      saveSalesData(salesData);
      renderSalesTable();
      
      showNotificationWithUndo(
        `Data penjualan #${id} dihapus`,
        'success',
        `‚Ü∂ Batalkan`,
        undoSalesAction
      );
    }
  });
}

function undoSalesAction() {
  if (!salesBackup || !salesActionInfo) return;
  
  salesData = JSON.parse(JSON.stringify(salesBackup));
  saveSalesData(salesData);
  renderSalesTable();
  
  showNotification('Dibatalkan', 'Aksi dibatalkan', 'info');
  
  salesBackup = null;
  salesActionInfo = null;
}

function resetSales() {
  showDialog('Reset Data', 'Reset semua data penjualan?', () => {
    const resetData = getDefaultSalesData();
    
    saveSalesData(resetData);
    renderSalesTable();
    showNotification('Berhasil', 'Semua data direset', 'success');
  });
}

// ==================== NOTIFIKASI DENGAN UNDO ====================
function showNotificationWithUndo(message, type, undoText, undoCallback) {
  const container = document.getElementById('notificationContainer');
  
  const notifications = container.querySelectorAll('.notification');
  if (notifications.length >= 2) {
    notifications[0].remove();
  }
  
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  
  let icon = '‚ÑπÔ∏è';
  if (type === 'success') icon = '‚úÖ';
  if (type === 'warning') icon = '‚ö†Ô∏è';
  if (type === 'danger') icon = '‚ùå';
  
  notification.innerHTML = `
    <div class="notification-icon">${icon}</div>
    <div class="notification-content">
      <h4>Berhasil!</h4>
      <p>${message}</p>
      <button onclick="removeThisNotification(this); ${undoCallback.name}()" 
              style="margin-top: 5px; padding: 4px 10px; background: var(--warning); color: white; border: none; border-radius: 6px; font-size: 11px; cursor: pointer;">
        ${undoText}
      </button>
    </div>
    <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
  `;
  
  container.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentElement) {
      notification.remove();
    }
  }, 5000);
}

function removeThisNotification(button) {
  const notification = button.closest('.notification');
  if (notification) {
    notification.remove();
  }
}

// ==================== INISIALISASI APLIKASI ====================
document.addEventListener('DOMContentLoaded', function() {
  // Load semua data
  loadNIKData();
  renderSalesTable();
  
  // Tampilkan notifikasi selamat datang
  setTimeout(() => {
    showNotification('Selamat Datang', 'Aplikasi NIK GAS LPG siap digunakan', 'info');
  }, 500);
  
  // Validasi input angka di catatan penjualan
  document.getElementById('salesBody').addEventListener('input', function(e) {
    if (e.target.classList.contains('sales-input')) {
      e.target.value = e.target.value.replace(/\D/g, '');
    }
  });
});

// Backup data sebelum halaman ditutup
window.addEventListener('beforeunload', function() {
  saveNIKData();
  saveSalesData(salesData);
});
</script>
</body>
</html>
